import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";

export default function QuizApp() {
  const [started, setStarted] = useState(false);
  const [registered, setRegistered] = useState(false);
  const [username, setUsername] = useState(localStorage.getItem("username") || "");
  const [current, setCurrent] = useState(0);
  const [answers, setAnswers] = useState({});
  const [score, setScore] = useState(null);
  const [timeLeft, setTimeLeft] = useState(3600); // 1 hour = 3600 sec

  // ‡≤°‡≥Ü‡≤Æ‡≥ã ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å
  const questions = [
    {
      q: "‡≤µ‡≤ø‡≤ú‡≤Ø‡≤®‡≤ó‡≤∞ ‡≤∏‡≤æ‡≤Æ‡≥ç‡≤∞‡≤æ‡≤ú‡≥ç‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ø‡≤æ‡≤∞‡≥Å ‡≤∏‡≥ç‡≤•‡≤æ‡≤™‡≤ø‡≤∏‡≤ø‡≤¶‡≤∞‡≥Å?",
      options: ["‡≤π‡≤∞‡≤ø‡≤π‡≤∞ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥Å‡≤ï‡≥ç‡≤ï", "‡≤ï‡≥É‡≤∑‡≥ç‡≤£‡≤¶‡≥á‡≤µ‡≤∞‡≤æ‡≤Ø", "‡≤∞‡≤æ‡≤Ø‡≤∞ ‡≤∞‡≤æ‡≤ú", "‡≤§‡≤ø‡≤∞‡≥Å‡≤Æ‡≤≤ ‡≤¶‡≥á‡≤µ‡≤∞‡≤æ‡≤Ø", "‡≤ó‡≥ä‡≤§‡≥ç‡≤§‡≤ø‡≤≤‡≥ç‡≤≤"],
      answer: "‡≤π‡≤∞‡≤ø‡≤π‡≤∞ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥Å‡≤ï‡≥ç‡≤ï",
    },
    {
      q: "‡≤¨‡≤π‡≥Å‡≤Æ‡≤®‡≤ø ‡≤∏‡≥Å‡≤≤‡≥ç‡≤§‡≤æ‡≤®‡≤∞ ‡≤∞‡≤æ‡≤ú‡≤ß‡≤æ‡≤®‡≤ø ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥Å?",
      options: ["‡≤ó‡≥Å‡≤≤‡≥ç‡≤¨‡≤∞‡≥ç‡≤ó‡≤æ", "‡≤¨‡≥Ä‡≤ú‡≤æ‡≤™‡≥Å‡≤∞", "‡≤¨‡≤ø‡≤¶‡≤∞‡≥ç", "‡≤π‡≤Ç‡≤™‡≤ø", "‡≤ó‡≥ä‡≤§‡≥ç‡≤§‡≤ø‡≤≤‡≥ç‡≤≤"],
      answer: "‡≤ó‡≥Å‡≤≤‡≥ç‡≤¨‡≤∞‡≥ç‡≤ó‡≤æ",
    },
    {
      q: "‡≤Æ‡≤π‡≤Æ‡≥ç‡≤Æ‡≤¶‡≥ç ‡≤¨‡≤ø‡≤®‡≥ç ‡≤§‡≥Å‡≤ò‡≤≤‡≤ï‡≥ç ‡≤Ø‡≤æ‡≤µ ‡≤µ‡≤Ç‡≤∂‡≤¶‡≤µ‡≤∞‡≥Å?",
      options: ["‡≤§‡≥Å‡≤ò‡≤≤‡≤ï‡≥ç", "‡≤ñ‡≤ø‡≤≤‡≥ç‡≤ú‡≤ø", "‡≤≤‡≥ã‡≤¶‡≤ø", "‡≤∏‡≤Ø‡≥ç‡≤Ø‡≤ø‡≤¶", "‡≤ó‡≥ä‡≤§‡≥ç‡≤§‡≤ø‡≤≤‡≥ç‡≤≤"],
      answer: "‡≤§‡≥Å‡≤ò‡≤≤‡≤ï‡≥ç",
    },
  ];

  // ‡≤ü‡≥à‡≤Æ‡≤∞‡≥ç ‡≤≤‡≤æ‡≤ú‡≤ø‡≤ï‡≥ç
  useEffect(() => {
    if (!started || score !== null || timeLeft <= 0) return;
    const timer = setInterval(() => setTimeLeft((t) => t - 1), 1000);
    return () => clearInterval(timer);
  }, [started, score, timeLeft]);

  // ‡≤â‡≤§‡≥ç‡≤§‡≤∞ ‡≤ï‡≥ç‡≤≤‡≤ø‡≤ï‡≥ç
  const handleOption = (opt) => setAnswers({ ...answers, [current]: opt });

  // ‡≤´‡≤≤‡≤ø‡≤§‡≤æ‡≤Ç‡≤∂ ‡≤≤‡≥Ü‡≤ï‡≥ç‡≤ï
  const handleSubmit = () => {
    let sc = 0;
    questions.forEach((q, i) => {
      if (answers[i] === q.answer) sc++;
    });
    setScore(sc);
  };

  const percent = score !== null ? Math.round((score / questions.length) * 100) : 0;

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-700 to-blue-900 text-white flex flex-col items-center p-6">
      {!registered ? (
        // üìç Registration Screen
        <div className="flex flex-col justify-center items-center h-screen text-center">
          <h1 className="text-5xl font-bold mb-4">AJAY KUMAR QUESTION BANK</h1>
          <h2 className="text-2xl mb-6">‡≤Ö‡≤ú‡≤Ø‡≥ç ‡≤ï‡≥Å‡≤Æ‡≤æ‡≤∞‡≥ç ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç</h2>
          <input
            type="text"
            placeholder="Enter your name / ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="text-black px-4 py-2 rounded-lg mb-4 w-64 text-center"
          />
          <button
            onClick={() => {
              if (username.trim() !== "") {
                localStorage.setItem("username", username);
                setRegistered(true);
              }
            }}
            className="bg-green-500 text-black px-6 py-3 rounded-lg text-xl hover:bg-green-400 transition-all"
          >
            Register
          </button>
        </div>
      ) : !started ? (
        // üìç Start Page
        <div className="flex flex-col items-center justify-center h-screen">
          <h1 className="text-4xl font-bold mb-6">Welcome, {username} üëã</h1>
          <motion.div
            className="bg-yellow-400 text-black px-4 py-2 rounded mb-6 text-lg font-semibold overflow-hidden whitespace-nowrap w-full"
            animate={{ x: ["100%", "-100%"] }}
            transition={{ repeat: Infinity, duration: 10, ease: "linear" }}
          >
            ‚ö° ‡≤Æ‡≤ø‡≤®‡≤ø‡≤Æ‡≤Æ‡≥ç 50 ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞ ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≤∞‡≥Ü ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤ì‡≤¶‡≥Å‡≤§‡≥ç‡≤§‡≥Ä‡≤∞‡≤ø ‡≤é‡≤Ç‡≤¶‡≤∞‡≥ç‡≤• ‚ö°
          </motion.div>
          <button
            onClick={() => setStarted(true)}
            className="bg-green-500 text-black px-8 py-4 rounded-lg text-2xl font-bold hover:bg-green-400 transition-all"
          >
            Start Quiz
          </button>
        </div>
      ) : score === null ? (
        // üìç Quiz Page
        <div className="w-full max-w-2xl bg-blue-900 p-6 rounded-2xl shadow-lg">
          <div className="flex justify-between mb-4">
            <p className="text-lg">üë§ {username}</p>
            <p className="text-lg">
              Time Left: {Math.floor(timeLeft / 60)}m {timeLeft % 60}s
            </p>
          </div>
          <h3 className="text-2xl mb-4">
            Q{current + 1}. {questions[current].q}
          </h3>
          <div className="space-y-3">
            {questions[current].options.map((opt, idx) => (
              <button
                key={idx}
                onClick={() => handleOption(opt)}
                className={`block w-full text-left px-4 py-2 rounded-lg border ${
                  answers[current] === opt
                    ? "bg-green-500"
                    : "bg-blue-700 hover:bg-blue-600"
                }`}
              >
                {String.fromCharCode(65 + idx)}. {opt}
              </button>
            ))}
          </div>

          <div className="flex justify-between mt-6">
            <button
              onClick={() => setCurrent((c) => Math.max(0, c - 1))}
              className="bg-gray-400 px-4 py-2 rounded-lg text-black"
            >
              Prev
            </button>
            {current < questions.length - 1 ? (
              <button
                onClick={() => setCurrent((c) => Math.min(questions.length - 1, c + 1))}
                className="bg-yellow-400 px-4 py-2 rounded-lg text-black"
              >
                Next
              </button>
            ) : (
              <button
                onClick={handleSubmit}
                className="bg-green-500 px-4 py-2 rounded-lg text-black"
              >
                Submit Quiz
              </button>
            )}
          </div>
        </div>
      ) : (
        // üìç Result Page
        <div className="bg-blue-900 p-6 rounded-2xl shadow-lg text-center">
          <h2 className="text-3xl mb-4">Result / ‡≤´‡≤≤‡≤ø‡≤§‡≤æ‡≤Ç‡≤∂</h2>
          <p className="text-xl mb-2">Name: {username}</p>
          <p className="text-xl mb-2">Marks: {score} / {questions.length}</p>
          <p className="text-xl mb-2">Percentage: {percent}%</p>
          {percent >= 50 ? (
            <p className="text-green-400 text-2xl font-bold">
              You are doing well! ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤ì‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø! üéâ
            </p>
          ) : (
            <p className="text-red-400 text-2xl font-bold">
              You are not studying well üò¢ ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤ì‡≤¶‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤≤‡≥ç‡≤≤!
            </p>
          )}
          <p className="mt-4 text-lg">‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å / Thank you!</p>
        </div>
      )}
    </div>
  );
}
